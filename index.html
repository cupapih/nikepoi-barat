<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nekopara</title>
<link rel="stylesheet" href="css/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  /* Simple styling */
  .grid-container { display: grid; grid-template-columns: repeat(auto-fill,minmax(200px,1fr)); gap:10px; padding:10px; }
  .card { border:1px solid #ccc; padding:10px; border-radius:5px; background:#f9f9f9; }
  .overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center; z-index:1000; }
  .overlay-content { background:#fff; padding:20px; max-height:80%; overflow:auto; border-radius:5px; }
  .close-btn { margin-top:10px; padding:5px 10px; cursor:pointer; }
</style>
</head>
<body>

<nav>
  <input type="text" id="searchInput" placeholder="Cari...">
  <button onclick="searchPosts()">Search</button>
</nav>

<main id="postGrid" class="grid-container"></main>

<div class="pagination">
  <button onclick="prevPage()">Previous</button>
  <button onclick="nextPage()">Next</button>
</div>

<div id="overlay" class="overlay" onclick="closeOverlay(event)">
  <div class="overlay-content" id="overlayContent"></div>
  <button class="close-btn" onclick="closeOverlay(event)">Tutup</button>
</div>

<script>
let allPosts = [];
let currentPage = 1;
const postsPerPage = 10;

// ðŸ”¹ Fetch index.json dari root
fetch("index.json")
  .then(res => {
    if (!res.ok) throw new Error("File index.json tidak ditemukan!");
    return res.json();
  })
  .then(data => {
    allPosts = data.files;
    displayPage(currentPage);
  })
  .catch(err => console.error("Error fetch index.json:", err));

// ðŸ”¹ Display posts per page
function displayPage(page) {
  const grid = document.getElementById("postGrid");
  grid.innerHTML = "";
  const start = (page - 1) * postsPerPage;
  const end = start + postsPerPage;
  const pagePosts = allPosts.slice(start, end);

  pagePosts.forEach(item => {
    const filePath = "data/" + item.file;
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h3>${item.file}</h3>
      <button onclick="showOverlay('${filePath}')">Lihat</button>
    `;
    grid.appendChild(div);
  });
}

// ðŸ”¹ Pagination
function nextPage() {
  if (currentPage * postsPerPage < allPosts.length) {
    currentPage++;
    displayPage(currentPage);
  }
}

function prevPage() {
  if (currentPage > 1) {
    currentPage--;
    displayPage(currentPage);
  }
}

// ðŸ”¹ Overlay
function showOverlay(filePath) {
  const overlay = document.getElementById("overlay");
  const content = document.getElementById("overlayContent");
  overlay.style.display = "flex";
  fetch(filePath)
    .then(res => res.text())
    .then(txt => {
      content.innerHTML = `<pre>${txt}</pre>`;
    });
}

function closeOverlay(event) {
  if (event.target.id === "overlay" || event.target.classList.contains("close-btn")) {
    document.getElementById("overlay").style.display = "none";
  }
}

// ðŸ”¹ Search
function searchPosts() {
  const query = document.getElementById("searchInput").value.trim().toLowerCase();
  const filtered = allPosts.filter(item => item.file.toLowerCase().includes(query));
  currentPage = 1;
  displayFiltered(filtered);
}

function displayFiltered(filteredPosts) {
  const grid = document.getElementById("postGrid");
  grid.innerHTML = "";
  filteredPosts.forEach(item => {
    const filePath = "data/" + item.file;
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `<h3>${item.file}</h3><button onclick="showOverlay('${filePath}')">Lihat</button>`;
    grid.appendChild(div);
  });
}
</script>
</body>
</html>
